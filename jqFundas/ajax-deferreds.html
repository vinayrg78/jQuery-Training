<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"><title>jQuery Fundamentals :: AJAX &amp; Deferreds</title><link rel="stylesheet" href="ajax-deferreds_files/codemirror.css"><link rel="shortcut icon" href="http://jqfundamentals.com/favicon.ico"><link rel="stylesheet" href="ajax-deferreds_files/bootstrap.css"><link rel="stylesheet" href="ajax-deferreds_files/base.css"><script src="ajax-deferreds_files/ga.js" async="" type="text/javascript"></script><script src="ajax-deferreds_files/main.js" data-requiremodule="main" data-requirecontext="_" async="" charset="utf-8" type="text/javascript"></script><script src="ajax-deferreds_files/chapter.js" data-requiremodule="js/chapter" data-requirecontext="_" async="" charset="utf-8" type="text/javascript"></script></head><body><div class="navbar navbar-fixed-top"><div class="navbar-inner"><div class="container"><a href="http://jqfundamentals.com/" class="brand">jQuery Fundamentals</a><ul class="nav"><li><a href="http://jqfundamentals.com/">Home</a></li><li class="dropdown"><a data-toggle="dropdown" href="#" class="dropdown-toggle">Contents »</a><ul class="dropdown-menu"><li><a href="http://jqfundamentals.com/chapter/javascript-basics">JavaScript Basics</a></li><li><a href="http://jqfundamentals.com/chapter/jquery-basics">jQuery Basics</a></li><li><a href="http://jqfundamentals.com/chapter/traversing-manipulating">Traversing &amp; Manipulating</a></li><li><a href="http://jqfundamentals.com/chapter/events">Events &amp; Event Delegation</a></li><li><a href="http://jqfundamentals.com/chapter/effects">Effects</a></li><li><a href="http://jqfundamentals.com/chapter/ajax-deferreds">AJAX &amp; Deferreds</a></li></ul></li><li><a href="mailto:jqf@bocoup.com">Feedback</a></li></ul><div class="pull-right"><button id="editor-btn" class="btn btn-primary">Show Editor</button></div></div></div><div class="container"><div id="sandbox" class="row"><div class="span8"><div id="editor"><div class="editor"><div class="editor-buttons"><i title="Execute Code" class="icon-play"></i><i title="Reset to original" class="icon-repeat"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03333px; left: 31.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 28.9px;"><div style="position: relative; top: 0px;"><div style="height: 250px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 26px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre> </pre></div></div></div></div></div></div></div></div></div></div><div id="results" class="span4"><div class="results-container"><iframe src="ajax-deferreds_files/ajax-deferreds.html" frameborder="0"></iframe></div></div></div></div></div><div class="container"><div id="main" data-chapter="/sandbox/ajax-deferreds"><div class="page-header"><h1>AJAX &amp; Deferreds</h1></div><div class="row"><div class="span4"><div id="links" class="well"><ul class="nav nav-list"><li class="nav-header">Additional Resources</li><li><a href="http://api.jquery.com/category/ajax/">Ajax Documentation</a></li><li><a href="http://api.jquery.com/jQuery.ajax/#jqXHR">The jqXHR Object</a></li><li><a href="http://api.jquery.com/category/deferred-object/">Deferreds in jQuery</a></li></ul></div><div class="well bocoup-ad"><p class="centered"><a href="http://training.bocoup.com/"><img src="ajax-deferreds_files/henrietta-and-jude-small.png"></a></p><p>jQuery Fundamentals is brought to you by
<a href="http://training.bocoup.com/?utm_source=jqf&amp;utm_medium=promo_block&amp;utm_campaign=jqf_app"><strong>Bocoup Training</strong></a>.</p><p><strong>Upcoming classes:</strong><br>  
<a href="http://training.bocoup.com/?utm_source=jqf&amp;utm_medium=promo_block&amp;utm_content=comp_jquery&amp;utm_campaign=jqf_app">Comprehensive jQuery</a><br>
<a href="http://training.bocoup.com/?utm_source=jqf&amp;utm_medium=promo_block&amp;utm_content=js_foundations&amp;utm_campaign=jqf_app">Foundations of Programming with JS</a><br>
<a href="http://training.bocoup.com/?utm_source=jqf&amp;utm_medium=promo_block&amp;utm_content=js_best&amp;utm_campaign=jqf_app">JavaScript Best Practices</a></p></div></div><div class="span8"><h2>AJAX</h2>
<p>AJAX -- "asynchronous JavaScript and XML" &#8212; is a means of loading 
data from a
server without requiring a page reload. It uses a browser's built-in 
XMLHttpRequest (XHR) functionality to make a request to the server and 
then handle the data that the server returns.

</p>
<p>jQuery provides the <code>$.ajax</code> method  &#8212; and several convenience methods  &#8212; to make it easier to work with XHRs across browsers.

</p>
<h3>$.ajax</h3>
<p>We can use the jQuery <code>$.ajax()</code> method in a couple of 
different ways: we can pass it a configuration object as its sole 
argument, or we can pass it a URL and an optional configuration object. 
Let's take a look at the first approach:

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03333px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 425.8px;"><div style="position: relative; top: 0px;"><div style="height: 426px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre><pre>16</pre><pre>17</pre><pre>18</pre><pre>19</pre><pre>20</pre><pre>21</pre><pre>22</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-comment">// Create the "callback" functions that will be invoked when...</span></pre><pre> </pre><pre><span class="cm-comment">// ... the AJAX request is successful</span></pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">updatePage</span> = <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span>).<span class="cm-property">html</span>( <span class="cm-variable-2">resp</span>.<span class="cm-property">people</span>[<span class="cm-number">0</span>].<span class="cm-property">name</span> );</pre><pre>};</pre><pre> </pre><pre><span class="cm-comment">// ... the AJAX request fails</span></pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">printError</span> = <span class="cm-keyword">function</span>( <span class="cm-def">req</span>, <span class="cm-def">status</span>, <span class="cm-def">err</span> ) {</pre><pre>  <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-string">'something went wrong'</span>, <span class="cm-variable-2">status</span>, <span class="cm-variable-2">err</span> );</pre><pre>};</pre><pre> </pre><pre><span class="cm-comment">// Create an object to describe the AJAX request</span></pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">ajaxOptions</span> = {</pre><pre>  <span class="cm-property">url</span>: <span class="cm-string">'/data/people.json'</span>,</pre><pre>  <span class="cm-property">dataType</span>: <span class="cm-string">'json'</span>,</pre><pre>  <span class="cm-property">success</span>: <span class="cm-variable">updatePage</span>,</pre><pre>  <span class="cm-property">error</span>: <span class="cm-variable">printError</span></pre><pre>};</pre><pre> </pre><pre><span class="cm-comment">// Initiate the request!</span></pre><pre><span class="cm-variable">$</span>.<span class="cm-property">ajax</span>(<span class="cm-variable">ajaxOptions</span>);</pre></div></div></div></div></div></div></div></div>
<p>Of course, you can be less verbose by just passing an object literal to the <code>$.ajax()</code> method, and using anonymous functions for the <code>success</code> and <code>error</code> callbacks. This version is easier to write, and likely easier to maintain:

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror CodeMirror-focused"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03333px; left: 104.033px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 199px;"><div style="position: relative; top: 0px;"><div style="height: 199px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"><pre><span class="cm-variable">$</span>.<span class="cm-property">ajax</span>({<span id="CodeMirror-temp-1bae6"> </span></pre></div><pre style="top: 0px; left: 72px; visibility: hidden;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-variable">$</span>.<span class="cm-property">ajax</span>({</pre><pre>  <span class="cm-property">url</span>: <span class="cm-string">'/data/people.json'</span>,</pre><pre>  <span class="cm-property">dataType</span>: <span class="cm-string">'json'</span>,</pre><pre>  <span class="cm-property">success</span>: <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>    <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span>).<span class="cm-property">html</span>( <span class="cm-variable-2">resp</span>.<span class="cm-property">people</span>[<span class="cm-number">0</span>].<span class="cm-property">name</span> );</pre><pre>  },</pre><pre>  <span class="cm-property">error</span>: <span class="cm-keyword">function</span>( <span class="cm-def">req</span>, <span class="cm-def">status</span>, <span class="cm-def">err</span> ) {</pre><pre>    <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-string">'something went wrong'</span>, <span class="cm-variable-2">status</span>, <span class="cm-variable-2">err</span> );</pre><pre>  }</pre><pre>});</pre></div></div></div></div></div></div></div></div>
<p>As mentioned earlier, you can also call the <code>$.ajax()</code> 
method by passing it a URL and an optional configuration object. This 
can be useful if you want to use the default configuration for <code>$.ajax()</code>, or if you want to use the same configuration for several URLs.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03333px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 199px;"><div style="position: relative; top: 0px;"><div style="height: 199px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-variable">$</span>.<span class="cm-property">ajax</span>( <span class="cm-string">'/data/people.json'</span>, {</pre><pre>  <span class="cm-property">type</span>: <span class="cm-string">'GET'</span>,</pre><pre>  <span class="cm-property">dataType</span>: <span class="cm-string">'json'</span>,</pre><pre>  <span class="cm-property">success</span>: <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>    <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-variable-2">resp</span>.<span class="cm-property">people</span> );</pre><pre>  },</pre><pre>  <span class="cm-property">error</span>: <span class="cm-keyword">function</span>( <span class="cm-def">req</span>, <span class="cm-def">status</span>, <span class="cm-def">err</span> ) {</pre><pre>    <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-string">'something went wrong'</span>, <span class="cm-variable-2">status</span>, <span class="cm-variable-2">err</span> );</pre><pre>  }</pre><pre>});</pre></div></div></div></div></div></div></div></div>
<p>In this version, only the URL is required, but the configuration object lets
us tell jQuery what data we want to send, which HTTP method to use (GET, POST,
etc.), what kind of data we expect to receive, how to react when the
request succeeds or fails, and much more.

</p>
<p><a href="http://api.jquery.com/jQuery.ajax/#jQuery-ajax-settings">See the <code>$.ajax()</code> documentation</a> for a complete list of configuration options.

</p>
<h3>A is for asynchronous</h3>
<p>AJAX requests run <em>asynchronously</em>  &#8212; that means that the <code>$.ajax</code> method
returns before the request is finished, and therefore before the <code>success</code>
callback runs. That means that this function's <code>return</code> statement runs before
the request is complete. This means the <code>getSomeData</code> function below will return <code>data</code> before it is defined, causing the code to throw an error.

</p>
<div class="editor-info"><span class="caution">caution</span> broken code</div><div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03333px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 293.5px;"><div style="position: relative; top: 0px;"><div style="height: 294px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">var</span> <span class="cm-variable">getSomeData</span> = <span class="cm-keyword">function</span>() {</pre><pre>  <span class="cm-keyword">var</span> <span class="cm-def">data</span>;</pre><pre> </pre><pre>  <span class="cm-variable">$</span>.<span class="cm-property">ajax</span>({</pre><pre>    <span class="cm-property">url</span>: <span class="cm-string">'/data/people.json'</span>,</pre><pre>    <span class="cm-property">dataType</span>: <span class="cm-string">'json'</span>,</pre><pre>    <span class="cm-property">success</span>: <span class="cm-keyword">function</span>(<span class="cm-def">resp</span>) {</pre><pre>      <span class="cm-variable-2">data</span> = <span class="cm-variable-2">resp</span>.<span class="cm-property">people</span>;</pre><pre>    }</pre><pre>  });</pre><pre> </pre><pre>  <span class="cm-keyword">return</span> <span class="cm-variable-2">data</span>;</pre><pre>}</pre><pre> </pre><pre><span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">html</span>( <span class="cm-variable">getSomeData</span>().<span class="cm-property">people</span>[<span class="cm-number">0</span>].<span class="cm-property">name</span> );</pre></div></div></div></div></div></div></div></div>
<h3>X is for JSON</h3>
<p>The term AJAX was <a href="http://www.adaptivepath.com/ideas/ajax-new-approach-web-applications">coined in 2005</a>
 to describe a method for retrieving data from a server without 
requiring a page refresh. Back then, data sent by a server tended to be 
formatted as <a href="http://en.wikipedia.org/wiki/XML">XML</a>, but these days, most modern applications use <a href="http://www.json.org/">JSON</a> as the format for data from the server.

</p>
<p>JSON is a string representation of data; it looks a whole lot like a 
normal JavaScript object, but it can only be used to represent a subset 
of the data that a normal JavaScript object can represent. For example, 
JSON cannot represent function or date objects. Here's an example of a 
JSON string; note how all property names are quoted:

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 331.3px; width: 1236px;"><div style="position: relative; top: 0px;"><div style="height: 331px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre><pre>16</pre><pre>17</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; width: 1231px; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre>{ <span class="cm-string">"people"</span> : [</pre><pre>  {</pre><pre>    <span class="cm-string">"name"</span> : <span class="cm-string">"Ben"</span>,</pre><pre>    <span class="cm-string">"url"</span> : <span class="cm-string">"http://benalman.com/"</span>,</pre><pre>    <span class="cm-string">"bio"</span> : <span class="cm-string">"I create groovy websites, useful jQuery plugins, and play a mean funk bass. I'm also Director of Pluginization at @bocoup."</span></pre><pre>  },</pre><pre>  {</pre><pre>    <span class="cm-string">"name"</span> : <span class="cm-string">"Rebecca"</span>,</pre><pre>    <span class="cm-string">"url"</span> : <span class="cm-string">"http://rmurphey.com"</span>,</pre><pre>    <span class="cm-string">"bio"</span> : <span class="cm-string">"Senior JS dev at Bocoup"</span></pre><pre>  },</pre><pre>  {</pre><pre>    <span class="cm-string">"name"</span> : <span class="cm-string">"Jory"</span>,</pre><pre>    <span class="cm-string">"url"</span> : <span class="cm-string">"http://joryburson.com"</span>,</pre><pre>    <span class="cm-string">"bio"</span> : <span class="cm-string">"super-enthusiastic about open web education @bocoup. lover of media, art, and fake mustaches."</span></pre><pre>  }</pre><pre>] }</pre></div></div></div></div></div></div></div></div>
<p>It's important to remember that <em>JSON is a string representation of an object</em>
  &#8212; the string must be parsed into an actual JavaScript object before 
working with it. When you're working with a JSON response to an XHR, 
jQuery takes care of this task for you, but it's crucial to understand 
the difference between the JSON representation of an object, and the 
object itself.

</p>
<div class="alert alert-info">
  If you need to create a JSON string from a JavaScript object, or if 
you need to parse a JSON string outside of jQuery, modern browsers 
provide the <code>JSON.stringify()</code> and <code>JSON.parse()</code> methods. This functionality can be added to older browsers using the <a href="https://github.com/douglascrockford/JSON-js">json2.js</a> library. jQuery also provides the <code>jQuery.parseJSON</code> method, which provides the same functionality as <code>JSON.parse()</code> across all browsers. However, jQuery does not provide a method that corresponds to <code>JSON.stringify()</code>.
</div>

<h3>Convenience methods</h3>
<p>If we're just making a simple request  &#8212; and if we don't care about error
handling  &#8212; jQuery provides several "convenience methods" that let us use an
abbreviated syntax. Each of these methods takes a URL, an optional data object,
and an optional callback for handling a successful request.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 31.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 142.3px;"><div style="position: relative; top: 0px;"><div style="height: 142px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 26px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-variable">$</span>.<span class="cm-property">get</span>( <span class="cm-string">'/data/people.html'</span>, <span class="cm-keyword">function</span>( <span class="cm-def">html</span> ){</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">html</span>( <span class="cm-variable-2">html</span> );</pre><pre>});</pre><pre> </pre><pre><span class="cm-variable">$</span>.<span class="cm-property">post</span>( <span class="cm-string">'/data/save'</span>, { <span class="cm-property">name</span>: <span class="cm-string">'Rebecca'</span> }, <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>  <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-variable">JSON</span>.<span class="cm-property">parse</span>( <span class="cm-variable-2">resp</span> ) );</pre><pre>});</pre></div></div></div></div></div></div></div></div>
<h3>Sending data &amp; working with forms</h3>
<p>We can send data with our request by setting the <code>data</code> property on our
configuration object, or by passing an object as the second argument to one of
the convenience methods.

</p>
<p>For a GET request, this data will be appended to the URL as a query string;
for a POST request, it will be sent as form data. jQuery provides the helpful <code>.serialize()</code> method for taking form input and converting it to a query string format (<code>field1name=field1value&amp;field2name=field2value...</code>):

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03345px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 293.5px;"><div style="position: relative; top: 0px;"><div style="height: 294px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-variable">$</span>( <span class="cm-string">'form'</span> ).<span class="cm-property">submit</span>(<span class="cm-keyword">function</span>( <span class="cm-def">event</span> ) {</pre><pre>  <span class="cm-variable-2">event</span>.<span class="cm-property">preventDefault</span>();</pre><pre> </pre><pre>  <span class="cm-keyword">var</span> <span class="cm-def">form</span> = <span class="cm-variable">$</span>( <span class="cm-variable-2">this</span> );</pre><pre> </pre><pre>  <span class="cm-variable">$</span>.<span class="cm-property">ajax</span>({</pre><pre>    <span class="cm-property">type</span>: <span class="cm-string">'POST'</span>,</pre><pre>    <span class="cm-property">url</span>: <span class="cm-string">'/data/save'</span>,</pre><pre>    <span class="cm-property">data</span>: <span class="cm-variable-2">form</span>.<span class="cm-property">serialize</span>(),</pre><pre>    <span class="cm-property">dataType</span>: <span class="cm-string">'json'</span>,</pre><pre>    <span class="cm-property">success</span>: <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>      <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-variable-2">resp</span> );</pre><pre>    }</pre><pre>  });</pre><pre>});</pre></div></div></div></div></div></div></div></div>
<h3>jqXHR</h3>
<p><code>$.ajax()</code> (and related convenience methods) returns a jqXHR object  &#8212; a <em>jQuery XML HTTP Request</em>  &#8212; which has a host of powerful methods. We can make a request using <code>$.ajax()</code>, and then capture the returned jqXHR object in a variable.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03345px; left: 31.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 85.6px;"><div style="position: relative; top: 0px;"><div style="height: 86px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 26px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">var</span> <span class="cm-variable">req</span> = <span class="cm-variable">$</span>.<span class="cm-property">ajax</span>({</pre><pre>  <span class="cm-property">url</span>: <span class="cm-string">'/data/people.json'</span>,</pre><pre>  <span class="cm-property">dataType</span>: <span class="cm-string">'json'</span></pre><pre>});</pre></div></div></div></div></div></div></div></div>
<p>We can use this object to attach callbacks to the request, even after the request has completed. For example, we can use the <code>.then()</code> method of the jqXHR object to attach success and error callbacks. The <code>.then()</code>
 method takes one or two functions as its arguments. The first function 
will be be called if the request succeeds; the second will be called if 
the request fails.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 293.5px;"><div style="position: relative; top: 0px;"><div style="height: 294px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">var</span> <span class="cm-variable">success</span> = <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">append</span>(</pre><pre>    <span class="cm-string">'&lt;p&gt;people: '</span> + <span class="cm-variable-2">resp</span>.<span class="cm-property">people</span>.<span class="cm-property">length</span> + <span class="cm-string">'&lt;/p&gt;'</span></pre><pre>  );</pre><pre>  <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-variable-2">resp</span>.<span class="cm-property">people</span> );</pre><pre>};</pre><pre> </pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">err</span> = <span class="cm-keyword">function</span>( <span class="cm-def">req</span>, <span class="cm-def">status</span>, <span class="cm-def">err</span> ) {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">append</span>( <span class="cm-string">'&lt;p&gt;something went wrong&lt;/p&gt;'</span> );</pre><pre>};</pre><pre> </pre><pre><span class="cm-variable">req</span>.<span class="cm-property">then</span>( <span class="cm-variable">success</span>, <span class="cm-variable">err</span> );</pre><pre><span class="cm-variable">req</span>.<span class="cm-property">then</span>(<span class="cm-keyword">function</span>() {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">append</span>( <span class="cm-string">'&lt;p&gt;it worked&lt;/p&gt;'</span> );</pre><pre>});</pre></div></div></div></div></div></div></div></div>
<p>We can call <code>.then()</code> on a request as many times as we'd like; it's a first-in, first-out queue.

</p>
<p>If we don't want to attach success and error callbacks at the same time, we can
use the <code>.done()</code> and <code>.fail()</code> methods of the request object.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 31.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 47.8px;"><div style="position: relative; top: 0px;"><div style="height: 48px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 26px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-variable">req</span>.<span class="cm-property">done</span>( <span class="cm-variable">success</span> );</pre><pre><span class="cm-variable">req</span>.<span class="cm-property">fail</span>( <span class="cm-variable">err</span> );</pre></div></div></div></div></div></div></div></div>
<p>If we want to attach a callback that runs on success or failure, we can use the
<code>.always()</code> method of the request object.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03369px; left: 31.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 85.6px;"><div style="position: relative; top: 0px;"><div style="height: 86px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 26px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-variable">req</span>.<span class="cm-property">always</span>(<span class="cm-keyword">function</span>() {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> )</pre><pre>    .<span class="cm-property">append</span>( <span class="cm-string">'&lt;p&gt;one way or another, it is done now&lt;/p&gt;'</span> );</pre><pre>});</pre></div></div></div></div></div></div></div></div>
<h3>JSONP</h3>
<p>Many JavaScript developers are alarmed when they first try to use <code>$.ajax</code>
 to fetch data from another domain and their request fails. For example,
 you may try fetching data from a third-party API, and discover that 
your request consistently fails.

</p>
<p>As it turns out, for security reasons, XHRs to other domains are 
blocked by the browser. However, certain third-party APIs provide a 
response formatted as JSONP  &#8212; "JSON with Padding"  &#8212; which allows you 
to use their data even though it is hosted on another server.

</p>
<p>JSONP isn't exactly AJAX  &#8212; rather than using the browser's XHR 
functionality, it actually works by inserting a script tag into the page
 that contains the requested data, "padded" with a function wrapper. 
Nevertheless, jQuery lets you make a JSONP request with <code>$.ajax()</code> by specifying <code>'jsonp'</code> as the <code>dataType</code> in the configuration object.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 31.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 161.2px;"><div style="position: relative; top: 0px;"><div style="height: 161px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 26px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-variable">$</span>.<span class="cm-property">ajax</span>({</pre><pre>  <span class="cm-property">url</span>: <span class="cm-string">'/data/search.jsonp'</span>,</pre><pre>  <span class="cm-property">data</span>: { <span class="cm-property">q</span>: <span class="cm-string">'a'</span> },</pre><pre>  <span class="cm-property">dataType</span>: <span class="cm-string">'jsonp'</span>,</pre><pre>  <span class="cm-property">success</span>: <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>    <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">html</span>( <span class="cm-string">'Results: '</span> + <span class="cm-variable-2">resp</span>.<span class="cm-property">results</span>.<span class="cm-property">length</span> );</pre><pre>  }</pre><pre>});</pre></div></div></div></div></div></div></div></div>
<div class="alert alert-info">
An API that offers JSONP will specify the name of the callback parameter to use
in the query string; generally, this name is <code>callback</code>, and so jQuery uses
that as its default. However, you can override this callback name by specifying
the <code>jsonp</code> property in the configuration object passed to <code>$.ajax()</code>.
</div>

<p>You can also use the <code>$.getJSON()</code> convenience method to make a JSONP request;
if the URL includes <code>callback=?</code> or similar, then jQuery will treat it as a
JSONP request.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 31.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 104.5px;"><div style="position: relative; top: 0px;"><div style="height: 105px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 26px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-variable">$</span>.<span class="cm-property">getJSON</span>( <span class="cm-string">'/data/search.jsonp?q=a&amp;callback=?'</span>,</pre><pre>  <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>    <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">html</span>( <span class="cm-string">'Results: '</span> + <span class="cm-variable-2">resp</span>.<span class="cm-property">results</span>.<span class="cm-property">length</span> );</pre><pre>  }</pre><pre>);</pre></div></div></div></div></div></div></div></div>
<p><a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>
  &#8212; cross-origin resource sharing  &#8212; is another option for enabling 
cross-origin requests. However, it is not supported on older browsers, 
and it requires server-side configuration and manipulation of the XHR 
headers in order to work.

</p>
<h2>Deferreds</h2>
<p>The jqXHR object is simply a special flavor of a "deferred". jQuery lets you
create your own deferreds, which can be a powerful way for managing
asynchronous code. Deferreds provide a means to react to the eventual success
or failure of an asynchronous operation, and reduce the need for deeply nested
callbacks.

</p>
<h3>$.Deferred</h3>
<p>You can create your own deferreds using <code>$.Deferred()</code>. Here, we run a function
in a setTimeout, and "resolve" our deferred with the return value of that
function. We return the deferred's "promise"  &#8212; an object to which we can
attach callbacks, but which doesn't have the ability to modify the outcome of
deferred itself. We "reject" the deferred if anything goes wrong with running
the provided function.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 255.7px;"><div style="position: relative; top: 0px;"><div style="height: 256px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">function</span> <span class="cm-variable">doSomethingLater</span>( <span class="cm-def">fn</span>, <span class="cm-def">time</span> ) {</pre><pre>  <span class="cm-keyword">var</span> <span class="cm-def">dfd</span> = <span class="cm-variable">$</span>.<span class="cm-property">Deferred</span>();</pre><pre> </pre><pre>  <span class="cm-variable">setTimeout</span>(<span class="cm-keyword">function</span>() {</pre><pre>    <span class="cm-variable-2">dfd</span>.<span class="cm-property">resolve</span>( <span class="cm-variable-2">fn</span>() );</pre><pre>  }, <span class="cm-variable-2">time</span> || <span class="cm-number">0</span>);</pre><pre> </pre><pre>  <span class="cm-keyword">return</span> <span class="cm-variable-2">dfd</span>.<span class="cm-property">promise</span>();</pre><pre>}</pre><pre> </pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">promise</span> = <span class="cm-variable">doSomethingLater</span>(<span class="cm-keyword">function</span>() {</pre><pre>  <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-string">'This function will be called in 100ms'</span> );</pre><pre>}, <span class="cm-number">100</span>);</pre></div></div></div></div></div></div></div></div>
<h3>.then(), .done(), .fail(), .always()</h3>
<p>Just like with a jqXHR, we can attach success and error handlers to a promise.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03369px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 406.9px;"><div style="position: relative; top: 0px;"><div style="height: 407px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre><pre>16</pre><pre>17</pre><pre>18</pre><pre>19</pre><pre>20</pre><pre>21</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">function</span> <span class="cm-variable">doSomethingLater</span>( <span class="cm-def">fn</span>, <span class="cm-def">time</span> ) {</pre><pre>  <span class="cm-keyword">var</span> <span class="cm-def">dfd</span> = <span class="cm-variable">$</span>.<span class="cm-property">Deferred</span>();</pre><pre> </pre><pre>  <span class="cm-variable">setTimeout</span>(<span class="cm-keyword">function</span>() {</pre><pre>    <span class="cm-variable-2">dfd</span>.<span class="cm-property">resolve</span>( <span class="cm-variable-2">fn</span>() );</pre><pre>  }, <span class="cm-variable-2">time</span> || <span class="cm-number">0</span>);</pre><pre> </pre><pre>  <span class="cm-keyword">return</span> <span class="cm-variable-2">dfd</span>.<span class="cm-property">promise</span>();</pre><pre>}</pre><pre> </pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">success</span> = <span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">html</span>( <span class="cm-string">'it worked'</span> );</pre><pre>};</pre><pre> </pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">err</span> = <span class="cm-keyword">function</span>( <span class="cm-def">req</span>, <span class="cm-def">status</span>, <span class="cm-def">err</span> ) {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">html</span>( <span class="cm-string">'it failed'</span> );</pre><pre>};</pre><pre> </pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">dfd</span> = <span class="cm-variable">doSomethingLater</span>(<span class="cm-keyword">function</span>() { <span class="cm-comment">/* ... */</span> }, <span class="cm-number">100</span>);</pre><pre> </pre><pre><span class="cm-variable">dfd</span>.<span class="cm-property">then</span>( <span class="cm-variable">success</span>, <span class="cm-variable">err</span> );</pre></div></div></div></div></div></div></div></div>
<h3>pipe()</h3>
<p>We can use the <code>.pipe()</code> method of a promise to react to the resolution of an
asynchronous operation by manipulating the value it returns and creating a new
deferred.

</p>
<p>As of jQuery 1.8, the <code>.then()</code> method of a promise behaves like <code>.pipe()</code>.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 331.3px;"><div style="position: relative; top: 0px;"><div style="height: 331px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre><pre>16</pre><pre>17</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">function</span> <span class="cm-variable">doSomethingLater</span>( <span class="cm-def">fn</span>, <span class="cm-def">time</span> ) {</pre><pre>  <span class="cm-keyword">var</span> <span class="cm-def">dfd</span> = <span class="cm-variable">$</span>.<span class="cm-property">Deferred</span>();</pre><pre> </pre><pre>  <span class="cm-variable">setTimeout</span>(<span class="cm-keyword">function</span>() {</pre><pre>    <span class="cm-variable-2">dfd</span>.<span class="cm-property">resolve</span>( <span class="cm-variable-2">fn</span>() );</pre><pre>  }, <span class="cm-variable-2">time</span> || <span class="cm-number">0</span>);</pre><pre> </pre><pre>  <span class="cm-keyword">return</span> <span class="cm-variable-2">dfd</span>.<span class="cm-property">promise</span>();</pre><pre>}</pre><pre> </pre><pre><span class="cm-keyword">var</span> <span class="cm-variable">dfd</span> = <span class="cm-variable">doSomethingLater</span>(<span class="cm-keyword">function</span>() { <span class="cm-keyword">return</span> <span class="cm-number">1</span>; }, <span class="cm-number">100</span>);</pre><pre> </pre><pre><span class="cm-variable">dfd</span></pre><pre>  .<span class="cm-property">pipe</span>(<span class="cm-keyword">function</span>(<span class="cm-def">resp</span>) { <span class="cm-keyword">return</span> <span class="cm-variable-2">resp</span> + <span class="cm-string">' '</span> + <span class="cm-variable-2">resp</span>; })</pre><pre>  .<span class="cm-property">done</span>(<span class="cm-keyword">function</span>(<span class="cm-def">upperCaseResp</span>) {</pre><pre>    <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">html</span>( <span class="cm-variable-2">upperCaseResp</span> );</pre><pre>  });</pre></div></div></div></div></div></div></div></div>
<h3>Reacting to maybe-asynchronous operations</h3>
<p>Sometimes we have an operation that might return immediately, or
might be asynchronous  &#8212; for example, if a function does something
async the first time it runs, and then caches the value for future
use. In this case, we can use <code>$.when()</code> to react to either case.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 463.6px;"><div style="position: relative; top: 0px;"><div style="height: 464px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre><pre>16</pre><pre>17</pre><pre>18</pre><pre>19</pre><pre>20</pre><pre>21</pre><pre>22</pre><pre>23</pre><pre>24</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">function</span> <span class="cm-variable">maybeAsync</span>( <span class="cm-def">num</span> ) {</pre><pre>  <span class="cm-keyword">var</span> <span class="cm-def">dfd</span> = <span class="cm-variable">$</span>.<span class="cm-property">Deferred</span>();</pre><pre> </pre><pre>  <span class="cm-comment">// return a deferred when num === 1</span></pre><pre>  <span class="cm-keyword">if</span> ( <span class="cm-variable-2">num</span> === <span class="cm-number">1</span> ) {</pre><pre>    <span class="cm-variable">setTimeout</span>(<span class="cm-keyword">function</span>() {</pre><pre>      <span class="cm-variable-2">dfd</span>.<span class="cm-property">resolve</span>( <span class="cm-variable-2">num</span> );</pre><pre>    }, <span class="cm-number">100</span>);</pre><pre>    <span class="cm-keyword">return</span> <span class="cm-variable-2">dfd</span>.<span class="cm-property">promise</span>();</pre><pre>  }</pre><pre> </pre><pre>  <span class="cm-comment">// return immediately otherwise</span></pre><pre>  <span class="cm-keyword">return</span> <span class="cm-variable-2">num</span>;</pre><pre>}</pre><pre> </pre><pre><span class="cm-comment">// this will resolve async</span></pre><pre><span class="cm-variable">$</span>.<span class="cm-property">when</span>( <span class="cm-variable">maybeAsync</span>( <span class="cm-number">1</span> ) ).<span class="cm-property">then</span>(<span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">append</span>( <span class="cm-string">'&lt;p&gt;'</span> + <span class="cm-variable-2">resp</span> + <span class="cm-string">'&lt;/p&gt;'</span> );</pre><pre>});</pre><pre> </pre><pre><span class="cm-comment">// this will return immediately</span></pre><pre><span class="cm-variable">$</span>.<span class="cm-property">when</span>( <span class="cm-variable">maybeAsync</span>( <span class="cm-number">0</span> ) ).<span class="cm-property">then</span>(<span class="cm-keyword">function</span>( <span class="cm-def">resp</span> ) {</pre><pre>  <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> ).<span class="cm-property">append</span>( <span class="cm-string">'&lt;p&gt;'</span> + <span class="cm-variable-2">resp</span> + <span class="cm-string">'&lt;/p&gt;'</span> );</pre><pre>});</pre></div></div></div></div></div></div></div></div>
<p>You can also pass <code>$.when()</code> more than one argument, which lets you mix sync
and async operations; you get their return values back as arguments to the
callback.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.03418px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 406.9px;"><div style="position: relative; top: 0px;"><div style="height: 407px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre><pre>16</pre><pre>17</pre><pre>18</pre><pre>19</pre><pre>20</pre><pre>21</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">function</span> <span class="cm-variable">maybeAsync</span>( <span class="cm-def">num</span> ) {</pre><pre>  <span class="cm-keyword">var</span> <span class="cm-def">dfd</span> = <span class="cm-variable">$</span>.<span class="cm-property">Deferred</span>();</pre><pre> </pre><pre>  <span class="cm-comment">// return a deferred when num === 1</span></pre><pre>  <span class="cm-keyword">if</span> ( <span class="cm-variable-2">num</span> === <span class="cm-number">1</span> ) {</pre><pre>    <span class="cm-variable">setTimeout</span>(<span class="cm-keyword">function</span>() {</pre><pre>      <span class="cm-variable-2">dfd</span>.<span class="cm-property">resolve</span>( <span class="cm-variable-2">num</span> );</pre><pre>    }, <span class="cm-number">100</span>);</pre><pre>    <span class="cm-keyword">return</span> <span class="cm-variable-2">dfd</span>.<span class="cm-property">promise</span>();</pre><pre>  }</pre><pre> </pre><pre>  <span class="cm-comment">// return immediately otherwise</span></pre><pre>  <span class="cm-keyword">return</span> <span class="cm-variable-2">num</span>;</pre><pre>}</pre><pre> </pre><pre><span class="cm-variable">$</span>.<span class="cm-property">when</span>( <span class="cm-variable">maybeAsync</span>( <span class="cm-number">0</span> ), <span class="cm-variable">maybeAsync</span>( <span class="cm-number">1</span> ) )</pre><pre>  .<span class="cm-property">then</span>(<span class="cm-keyword">function</span>( <span class="cm-def">resp1</span>, <span class="cm-def">resp2</span> ) {</pre><pre>    <span class="cm-keyword">var</span> <span class="cm-def">target</span> = <span class="cm-variable">$</span>( <span class="cm-string">'#target'</span> );</pre><pre>    <span class="cm-variable-2">target</span>.<span class="cm-property">append</span>( <span class="cm-string">'&lt;p&gt;'</span> + <span class="cm-variable-2">resp1</span> + <span class="cm-string">'&lt;/p&gt;'</span> );</pre><pre>    <span class="cm-variable-2">target</span>.<span class="cm-property">append</span>( <span class="cm-string">'&lt;p&gt;'</span> + <span class="cm-variable-2">resp2</span> + <span class="cm-string">'&lt;/p&gt;'</span> );</pre><pre>  });</pre></div></div></div></div></div></div></div></div>
<p>When a jqXHR is one of the arguments to <code>$.when()</code>, we get an array of
arguments passed to our callback.

</p>
<div class="editor-container"><div class="editor-buttons"><i title="Try in editor" class="icon-eye-open"></i></div><div class="CodeMirror"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.0332px; left: 32.0333px;"><textarea style="position: absolute; padding: 0; width: 1px; height: 1em" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-default" tabindex="-1"><div style="position: relative; height: 369.1px;"><div style="position: relative; top: 0px;"><div style="height: 369px;" class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"><pre>1</pre><pre>2</pre><pre>3</pre><pre>4</pre><pre>5</pre><pre>6</pre><pre>7</pre><pre>8</pre><pre>9</pre><pre>10</pre><pre>11</pre><pre>12</pre><pre>13</pre><pre>14</pre><pre>15</pre><pre>16</pre><pre>17</pre><pre>18</pre><pre>19</pre></div></div><div class="CodeMirror-lines"><div draggable="true" style="position: relative; z-index: 0; outline: medium none; margin-left: 27px;"><div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden;"></div><pre style="top: 0px; left: 0px;" class="CodeMirror-cursor">&nbsp;</pre><div style="position: relative; z-index: -1; display: none;"></div><div style=""><pre><span class="cm-keyword">function</span> <span class="cm-variable">maybeAsync</span>( <span class="cm-def">num</span> ) {</pre><pre>  <span class="cm-keyword">var</span> <span class="cm-def">dfd</span> = <span class="cm-variable">$</span>.<span class="cm-property">Deferred</span>();</pre><pre> </pre><pre>  <span class="cm-comment">// return a deferred when num === 1</span></pre><pre>  <span class="cm-keyword">if</span> ( <span class="cm-variable-2">num</span> === <span class="cm-number">1</span> ) {</pre><pre>    <span class="cm-variable">setTimeout</span>(<span class="cm-keyword">function</span>() {</pre><pre>      <span class="cm-variable-2">dfd</span>.<span class="cm-property">resolve</span>( <span class="cm-variable-2">num</span> );</pre><pre>    }, <span class="cm-number">100</span>);</pre><pre>    <span class="cm-keyword">return</span> <span class="cm-variable-2">dfd</span>.<span class="cm-property">promise</span>();</pre><pre>  }</pre><pre> </pre><pre>  <span class="cm-comment">// return immediately otherwise</span></pre><pre>  <span class="cm-keyword">return</span> <span class="cm-variable-2">num</span>;</pre><pre>}</pre><pre> </pre><pre><span class="cm-variable">$</span>.<span class="cm-property">when</span>( <span class="cm-variable">maybeAsync</span>( <span class="cm-number">0</span> ), <span class="cm-variable">$</span>.<span class="cm-property">get</span>( <span class="cm-string">'/data/people.json'</span> ) )</pre><pre>  .<span class="cm-property">then</span>(<span class="cm-keyword">function</span>( <span class="cm-def">resp1</span>, <span class="cm-def">resp2</span> ) {</pre><pre>    <span class="cm-variable">console</span>.<span class="cm-property">log</span>( <span class="cm-string">"Both operations are done"</span>, <span class="cm-variable-2">resp1</span>, <span class="cm-variable-2">resp2</span> );</pre><pre>  });</pre></div></div></div></div></div></div></div></div>
<ul class="pager"><li class="previous"><a href="http://jqfundamentals.com/chapter/effects">&#8592;&nbsp;Previous:&nbsp;Effects</a></li></ul></div></div></div><footer><p>Copyright © 2012 <a href="http://bocoup.com/">Bocoup</a> &#8226; <a href="http://jqfundamentals.com/legacy">View the original book</a> &#8226; <a href="mailto:jqf@bocoup.com">Send feedback</a></p></footer></div><script src="ajax-deferreds_files/require.js" data-main="/public/v1348938024379/main"></script><script>require([ 'js/chapter' ]);
</script><script>var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-1464992-55']); _gaq.push(['_trackPageview']);

(function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })();</script></body></html>